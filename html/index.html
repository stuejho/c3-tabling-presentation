<!DOCTYPE html>
<html>
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <title>C3</title>
    
        <!-- Favicon -->
        <!-- <link rel="shortcut icon" href="favicon.ico" > -->
        
        <!-- Main stylesheet -->
        <link rel="stylesheet" href="css/main.css">
        
        <!-- Meta viewport tag to enable correct viewport on mobile devices -->
        <meta name="viewport" content="width=device-width,initial-scale=1">
    </head>
    <body>
        <main>
            <div class="stage" id="main-stage">
                <canvas id="matrix"></canvas>
                <div class="scene">
                    <div></div>
                    <div class="question">
                        <h1>What is ethical hacking?</h1>
                    </div>
                    <div></div>
                </div>
                <div class="scene">
                    <div></div>
                    <div class="question">
                        <h1>What is cryptography?</h1>
                    </div>
                    <div></div>
                </div>
                <div class="scene">
                    <div></div>
                    <div class="question">
                        <h1>Do you like free pizza?</h1>
                    </div>
                    <div></div>
                </div>
                <div class="scene">
                    <div></div>
                    <div class="question">
                        <h1>How are firewalls breached?</h1>
                    </div>
                    <div></div>
                </div>
            </div>
        </main>

        <!-- Set up matrix background, based on https://codepen.io/wefiy/pen/WPpEwo -->
        <script type="text/javascript">
            // Function to render characters
            function render(canvas, context, fontSize, characters, columnYs) {
                // Function constants
                const textColor = window.getComputedStyle(canvas).getPropertyValue("color");
                const font = window.getComputedStyle(canvas).getPropertyValue("font");
                const resetChance = 0.025;  // probability of resetting column
                                            // after traveling screen height

                // Matrix background is partially transparent to show a trail
                context.fillStyle = "rgba(0, 0, 0, 0.05)";
                context.fillRect(0, 0, canvas.width, canvas.height);

                // Set text properties
                context.fillStyle = textColor;
                context.font = font;

                // Draw a character for each column
                columnYs.forEach(function(yIndex, xIndex, arrRef) {
                    // Get a random character
                    const character = characters[Math.floor(Math.random() * characters.length)];
                    const xDraw = xIndex * fontSize;
                    const yDraw = yIndex * fontSize;

                    context.fillText(character, xDraw, yDraw);

                    // Randomly reset y-coordinate after reaching bottom of screen
                    if (yDraw > canvas.height && Math.random() < resetChance) arrRef[xIndex] = 0;

                    ++arrRef[xIndex];
                });
            }

            // Get canvas and context (where things are rendered)
            const matrixId = "matrix";
            let matrixCanvas = document.getElementById(matrixId);
            let ctx = matrixCanvas.getContext("2d");

            // Canvas size matches window size
            matrixCanvas.height = window.innerHeight;
            matrixCanvas.width = window.innerWidth;

            // Characters to display
            // https://scifi.stackexchange.com/questions/137575/is-there-a-list-of-the-symbols-shown-in-the-matrixthe-symbols-rain-how-many
            const charsUnsplit = "日ﾊﾐﾋｰｳｼﾅﾓﾆｻﾜﾂｵﾘｱﾎﾃﾏｹﾒｴｶｷﾑﾕﾗｾﾈｽﾀﾇﾍ012345789ZTHEMATRIX:・.\"=*+-<>¦｜ｸ";
            const chars = charsUnsplit.split('');

            // Use page font size to set matrix dimensions
            /* fontSize from document body: 
             * https://newbedev.com/how-can-i-get-default-font-size-in-pixels-by-using-javascript-or-jquery 
             */
            const fontSize = Number(window.getComputedStyle(matrixCanvas).getPropertyValue('font-size').match(/\d+/)[0]);
            const numCols = Math.ceil(matrixCanvas.width / fontSize);
            let yCoords = Array(numCols).fill(1); // initial y coordinate

            // Render characters
            const delay = 50; // milliseconds
            setInterval(render, delay,
                // arguments to render function
                matrixCanvas, ctx, fontSize, chars, yCoords);
        </script>

        <!-- Set up scene changes -->
        <script type="text/javascript">
            window.addEventListener("DOMContentLoaded", function() {
                let stage = document.getElementById("main-stage");
                let scenes = stage.getElementsByClassName("scene");
                const sendToBack = function(e) { stage.appendChild(scenes[0]); };
                for (let i = 0; i < scenes.length; i++) {
                    // when the animation ends, move the current first element to
                    // the back of the sets (since that's what appendChild does
                    // when an existing node is appended)
                    scenes[i].addEventListener("animationend", sendToBack);
                }
            });
        </script>
        <!-- Fix Chromium bug that causes CSS transitions to fire when form 
             elements are present.
             https://bugs.chromium.org/p/chromium/issues/detail?id=332189   -->
        <script> </script>
      </body>
</html>
